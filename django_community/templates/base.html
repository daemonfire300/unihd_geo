<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css"
	rel="stylesheet" media="screen">
<link href="{{ STATIC_URL }}css/main.css" rel="stylesheet"
	media="screen">
<link href="{{ STATIC_URL }}jgrowl/jquery.jgrowl.css" rel="stylesheet"
	media="screen">
	<title>{% block title %}{% endblock %} </title>
	
	{% load socketio_tags %}
    {% socketio %}
    
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="span12">
				<ul class="nav nav-pills">
					<li><a href="/member/profile/">Profile</a></li>
					<li><a href="/member/logout/">Logout</a></li>
					<li><a href="/member/login/">Login</a></li>
					<li><a href="/lobby/all/">Lobbies</a></li>
				</ul>
			</div>
		</div>
		<div class="row">
			<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
			<div id="chat">
				<ul>
				</ul>
			</div>
			<div class="span12">{% block content %} {% endblock %}</div>
		</div>
	</div>
	<script src="http://code.jquery.com/jquery-migrate-1.1.1.min.js"></script>
	<script src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js"></script>
	<script src="{{ STATIC_URL }}jgrowl/jquery.jgrowl.js"></script>
	<input type="hidden" id="session_key" value="{{ request.session.session_key }}">
	<script type="text/javascript">
	    $(function(){
	    	socket = new io.Socket();
		    socket.connect();
		    send = function(msg){
		    	socket.send({message: msg, session_key: false});
		    };
		    socket.on('connect', function() {
		        socket.subscribe('global_chat');
		        socket.send({"session_key": $('#session_key').val()});
		        send("hello world");
		    });
		    socket.on('message', function(data){
		    	console.log("received message")
		    	console.log(data);
		    	console.log(Date(data.timestamp));
		    	if(data.display){
		    		$('#chat ul').append('<li>'+Date(data.timestamp)+' '+data.username+' wrote: '+data.message+'</li>')
		    	}
		    });
		    
		    
	    });
    </script>
</body>
</html>